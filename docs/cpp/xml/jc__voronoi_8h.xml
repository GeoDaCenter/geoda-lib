<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="en-US">
  <compounddef id="jc__voronoi_8h" kind="file" language="C++">
    <compoundname>jc_voronoi.h</compoundname>
    <includes local="no">assert.h</includes>
    <includes local="no">math.h</includes>
    <includes local="no">stddef.h</includes>
    <includes local="no">stdlib.h</includes>
    <includedby refid="contiguity-weights_8cpp" local="yes">/Users/xun/github/geoda-lib/src/cpp/weights/contiguity-weights.cpp</includedby>
    <incdepgraph>
      <node id="1">
        <label>/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h</label>
        <link refid="jc__voronoi_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>assert.h</label>
      </node>
      <node id="3">
        <label>math.h</label>
      </node>
      <node id="4">
        <label>stddef.h</label>
      </node>
      <node id="5">
        <label>stdlib.h</label>
      </node>
    </incdepgraph>
    <invincdepgraph>
      <node id="1">
        <label>/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h</label>
        <link refid="jc__voronoi_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>/Users/xun/github/geoda-lib/src/cpp/weights/contiguity-weights.cpp</label>
        <link refid="contiguity-weights_8cpp"/>
      </node>
    </invincdepgraph>
    <innerclass refid="struct__jcv__point" prot="public">_jcv_point</innerclass>
    <innerclass refid="struct__jcv__graphedge" prot="public">_jcv_graphedge</innerclass>
    <innerclass refid="struct__jcv__site" prot="public">_jcv_site</innerclass>
    <innerclass refid="struct__jcv__edge" prot="public">_jcv_edge</innerclass>
    <innerclass refid="struct__jcv__rect" prot="public">_jcv_rect</innerclass>
    <innerclass refid="struct__jcv__diagram" prot="public">_jcv_diagram</innerclass>
    <sectiondef kind="define">
      <memberdef kind="define" id="jc__voronoi_8h_1a4d86a41e250d5cb383e6e63eea4fe0c9" prot="public" static="no">
        <name>JCV_REAL_TYPE</name>
        <initializer>float</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="170" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="170" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="jc__voronoi_8h_1a3ae890190ce57d8824a9b2353504eea2" prot="public" static="no">
        <name>JCV_ATAN2</name>
        <param><defname>_Y_</defname></param>
        <param><defname>_X_</defname></param>
        <initializer>atan2f(_Y_, _X_)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="174" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="174" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="jc__voronoi_8h_1afe69737cad28c5d558fe3cea50966e9b" prot="public" static="no">
        <name>JCV_SQRT</name>
        <param><defname>_X_</defname></param>
        <initializer>sqrtf(_X_)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="178" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="178" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="jc__voronoi_8h_1a48db6e7cc0b9a9a9a5ba3376a5191600" prot="public" static="no">
        <name>JCV_PI</name>
        <initializer>3.14159265358979323846264338327950288f</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="182" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="182" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="jc__voronoi_8h_1a2a69ca5cc2eadf70988d863847a87025" prot="public" static="no">
        <name>JCV_FLT_MAX</name>
        <initializer>3.402823466e+38F</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="186" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="186" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="jc__voronoi_8h_1a1e885658896f71cb1c180c93776eb6df" prot="public" static="no">
        <name>JCV_EDGE_INTERSECT_THRESHOLD</name>
        <initializer>1.0e-10F</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="190" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="190" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="typedef">
      <memberdef kind="typedef" id="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" prot="public" static="no">
        <type><ref refid="jc__voronoi_8h_1a4d86a41e250d5cb383e6e63eea4fe0c9" kindref="member">JCV_REAL_TYPE</ref></type>
        <definition>typedef JCV_REAL_TYPE jcv_real</definition>
        <argsstring></argsstring>
        <name>jcv_real</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="193" column="23" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="193" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__point" kindref="compound">_jcv_point</ref></type>
        <definition>typedef struct _jcv_point jcv_point</definition>
        <argsstring></argsstring>
        <name>jcv_point</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="200" column="11"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__graphedge" kindref="compound">_jcv_graphedge</ref></type>
        <definition>typedef struct _jcv_graphedge jcv_graphedge</definition>
        <argsstring></argsstring>
        <name>jcv_graphedge</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="208" column="15"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1a5386281099d8669709643c318b500893" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__site" kindref="compound">_jcv_site</ref></type>
        <definition>typedef struct _jcv_site jcv_site</definition>
        <argsstring></argsstring>
        <name>jcv_site</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="214" column="10"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__edge" kindref="compound">_jcv_edge</ref></type>
        <definition>typedef struct _jcv_edge jcv_edge</definition>
        <argsstring></argsstring>
        <name>jcv_edge</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="223" column="10"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__rect" kindref="compound">_jcv_rect</ref></type>
        <definition>typedef struct _jcv_rect jcv_rect</definition>
        <argsstring></argsstring>
        <name>jcv_rect</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="228" column="10"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" prot="public" static="no">
        <type>struct <ref refid="struct__jcv__diagram" kindref="compound">_jcv_diagram</ref></type>
        <definition>typedef struct _jcv_diagram jcv_diagram</definition>
        <argsstring></argsstring>
        <name>jcv_diagram</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="237" column="13"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" prot="public" static="no">
        <type>void *(*</type>
        <definition>typedef void *(* FJCVAllocFn) (void *userctx, size_t size)</definition>
        <argsstring>)(void *userctx, size_t size)</argsstring>
        <name>FJCVAllocFn</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="248" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="248" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" prot="public" static="no">
        <type>void(*</type>
        <definition>typedef void(* FJCVFreeFn) (void *userctx, void *p)</definition>
        <argsstring>)(void *userctx, void *p)</argsstring>
        <name>FJCVFreeFn</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="249" column="9" bodyfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" bodystart="249" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="jc__voronoi_8h_1a06e41773fa0f60c5dd38ec8fd24ee44c" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void jcv_diagram_generate</definition>
        <argsstring>(int num_points, const jcv_point *points, const jcv_rect *rect, jcv_diagram *diagram)</argsstring>
        <name>jcv_diagram_generate</name>
        <param>
          <type>int</type>
          <declname>num_points</declname>
        </param>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref> *</type>
          <declname>points</declname>
        </param>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref> *</type>
          <declname>rect</declname>
        </param>
        <param>
          <type><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref> *</type>
          <declname>diagram</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Uses malloc If rect is null, an automatic bounding box is calculated, with an extra padding of 10 units If rect is non null, all points will be culled against the bounding rect, and all edges will be clipped against it. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="246" column="13" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="246" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="jc__voronoi_8h_1a31d74234527a688f260a955dc9c5adfc" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void jcv_diagram_generate_useralloc</definition>
        <argsstring>(int num_points, const jcv_point *points, const jcv_rect *rect, void *userallocctx, FJCVAllocFn allocfn, FJCVFreeFn freefn, jcv_diagram *diagram)</argsstring>
        <name>jcv_diagram_generate_useralloc</name>
        <param>
          <type>int</type>
          <declname>num_points</declname>
        </param>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref> *</type>
          <declname>points</declname>
        </param>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref> *</type>
          <declname>rect</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>userallocctx</declname>
        </param>
        <param>
          <type><ref refid="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" kindref="member">FJCVAllocFn</ref></type>
          <declname>allocfn</declname>
        </param>
        <param>
          <type><ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref></type>
          <declname>freefn</declname>
        </param>
        <param>
          <type><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref> *</type>
          <declname>diagram</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="252" column="13" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="252" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="jc__voronoi_8h_1a2be8cceedaa369c8568076f049b5d9fa" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void jcv_diagram_free</definition>
        <argsstring>(jcv_diagram *diagram)</argsstring>
        <name>jcv_diagram_free</name>
        <param>
          <type><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref> *</type>
          <declname>diagram</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="257" column="13" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="257" declcolumn="13"/>
      </memberdef>
      <memberdef kind="function" id="jc__voronoi_8h_1a3f1f04b91dba62621ce99132ea03bdd5" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref> *</type>
        <definition>const jcv_site * jcv_diagram_get_sites</definition>
        <argsstring>(const jcv_diagram *diagram)</argsstring>
        <name>jcv_diagram_get_sites</name>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref> *</type>
          <declname>diagram</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="260" column="23" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="260" declcolumn="23"/>
      </memberdef>
      <memberdef kind="function" id="jc__voronoi_8h_1a6ed5fdcd8aa5764dae68f27f1ea152a6" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref> *</type>
        <definition>const jcv_edge * jcv_diagram_get_edges</definition>
        <argsstring>(const jcv_diagram *diagram)</argsstring>
        <name>jcv_diagram_get_edges</name>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref> *</type>
          <declname>diagram</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="265" column="23" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="265" declcolumn="23"/>
      </memberdef>
      <memberdef kind="function" id="jc__voronoi_8h_1af42b092404285d28eeb2c2a119d5e8d7" prot="public" static="no" extern="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref> *</type>
        <definition>const jcv_edge * jcv_diagram_get_next_edge</definition>
        <argsstring>(const jcv_edge *edge)</argsstring>
        <name>jcv_diagram_get_next_edge</name>
        <param>
          <type>const <ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref> *</type>
          <declname>edge</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" line="268" column="23" declfile="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h" declline="268" declcolumn="23"/>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//<sp/>NOLINT(legal/copyright)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"></highlight></codeline>
<codeline lineno="4"><highlight class="comment">ABOUT:</highlight></codeline>
<codeline lineno="5"><highlight class="comment"></highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/><sp/><sp/><sp/>A<sp/>fast<sp/>single<sp/>file<sp/>2D<sp/>voronoi<sp/>diagram<sp/>generator.</highlight></codeline>
<codeline lineno="7"><highlight class="comment"></highlight></codeline>
<codeline lineno="8"><highlight class="comment">HISTORY:</highlight></codeline>
<codeline lineno="9"><highlight class="comment"></highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/><sp/><sp/><sp/>0.6<sp/><sp/><sp/><sp/><sp/>2018-10-21<sp/><sp/>-<sp/>Removed<sp/>JCV_CEIL/JCV_FLOOR/JCV_FABS</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Optimizations:<sp/>Fewer<sp/>indirections,<sp/>better<sp/>beach<sp/>head<sp/>approximation</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/><sp/><sp/><sp/>0.5<sp/><sp/><sp/><sp/><sp/>2018-10-14<sp/><sp/>-<sp/>Fixed<sp/>issue<sp/>where<sp/>the<sp/>graph<sp/>edge<sp/>had<sp/>the<sp/>wrong<sp/>edge<sp/>assigned<sp/>(issue<sp/>#28)</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Fixed<sp/>issue<sp/>where<sp/>a<sp/>point<sp/>was<sp/>falsely<sp/>passing<sp/>the<sp/>jcv_is_valid()<sp/>test<sp/>(issue<sp/>#22)</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Fixed<sp/>jcv_diagram_get_edges()<sp/>so<sp/>it<sp/>now<sp/>returns<sp/>_all_<sp/>edges<sp/>(issue<sp/>#28)</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Added<sp/>jcv_diagram_get_next_edge()<sp/>to<sp/>skip<sp/>zero<sp/>length<sp/>edges<sp/>(issue<sp/>#10)</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Added<sp/>defines<sp/>JCV_CEIL/JCV_FLOOR/JCV_FLT_MAX<sp/>for<sp/>easier<sp/>configuration</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/><sp/><sp/><sp/>0.4<sp/><sp/><sp/><sp/><sp/>2017-06-03<sp/><sp/>-<sp/>Increased<sp/>the<sp/>max<sp/>number<sp/>of<sp/>events<sp/>that<sp/>are<sp/>preallocated</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/><sp/><sp/><sp/>0.3<sp/><sp/><sp/><sp/><sp/>2017-04-16<sp/><sp/>-<sp/>Added<sp/>clipping<sp/>box<sp/>as<sp/>input<sp/>argument<sp/>(Automatically<sp/>calcuated<sp/>if<sp/>needed)</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Input<sp/>points<sp/>are<sp/>pruned<sp/>based<sp/>on<sp/>bounding<sp/>box</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/><sp/><sp/><sp/>0.2<sp/><sp/><sp/><sp/><sp/>2016-12-30<sp/><sp/>-<sp/>Fixed<sp/>issue<sp/>of<sp/>edges<sp/>not<sp/>being<sp/>closed<sp/>properly</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Fixed<sp/>issue<sp/>when<sp/>having<sp/>many<sp/>events</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Fixed<sp/>edge<sp/>sorting</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Code<sp/>cleanup</highlight></codeline>
<codeline lineno="24"><highlight class="comment"><sp/><sp/><sp/><sp/>0.1<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Initial<sp/>version</highlight></codeline>
<codeline lineno="25"><highlight class="comment"></highlight></codeline>
<codeline lineno="26"><highlight class="comment">LICENSE:</highlight></codeline>
<codeline lineno="27"><highlight class="comment"></highlight></codeline>
<codeline lineno="28"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>MIT<sp/>License<sp/>(MIT)</highlight></codeline>
<codeline lineno="29"><highlight class="comment"></highlight></codeline>
<codeline lineno="30"><highlight class="comment"><sp/><sp/><sp/><sp/>Copyright<sp/>(c)<sp/>2018<sp/>Mathias<sp/>Westerdahl</highlight></codeline>
<codeline lineno="31"><highlight class="comment"></highlight></codeline>
<codeline lineno="32"><highlight class="comment"><sp/><sp/><sp/><sp/>Permission<sp/>is<sp/>hereby<sp/>granted,<sp/>free<sp/>of<sp/>charge,<sp/>to<sp/>any<sp/>person<sp/>obtaining<sp/>a<sp/>copy</highlight></codeline>
<codeline lineno="33"><highlight class="comment"><sp/><sp/><sp/><sp/>of<sp/>this<sp/>software<sp/>and<sp/>associated<sp/>documentation<sp/>files<sp/>(the<sp/>&quot;Software&quot;),<sp/>to<sp/>deal</highlight></codeline>
<codeline lineno="34"><highlight class="comment"><sp/><sp/><sp/><sp/>in<sp/>the<sp/>Software<sp/>without<sp/>restriction,<sp/>including<sp/>without<sp/>limitation<sp/>the<sp/>rights</highlight></codeline>
<codeline lineno="35"><highlight class="comment"><sp/><sp/><sp/><sp/>to<sp/>use,<sp/>copy,<sp/>modify,<sp/>merge,<sp/>publish,<sp/>distribute,<sp/>sublicense,<sp/>and/or<sp/>sell</highlight></codeline>
<codeline lineno="36"><highlight class="comment"><sp/><sp/><sp/><sp/>copies<sp/>of<sp/>the<sp/>Software,<sp/>and<sp/>to<sp/>permit<sp/>persons<sp/>to<sp/>whom<sp/>the<sp/>Software<sp/>is</highlight></codeline>
<codeline lineno="37"><highlight class="comment"><sp/><sp/><sp/><sp/>furnished<sp/>to<sp/>do<sp/>so,<sp/>subject<sp/>to<sp/>the<sp/>following<sp/>conditions:</highlight></codeline>
<codeline lineno="38"><highlight class="comment"></highlight></codeline>
<codeline lineno="39"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>above<sp/>copyright<sp/>notice<sp/>and<sp/>this<sp/>permission<sp/>notice<sp/>shall<sp/>be<sp/>included<sp/>in<sp/>all</highlight></codeline>
<codeline lineno="40"><highlight class="comment"><sp/><sp/><sp/><sp/>copies<sp/>or<sp/>substantial<sp/>portions<sp/>of<sp/>the<sp/>Software.</highlight></codeline>
<codeline lineno="41"><highlight class="comment"></highlight></codeline>
<codeline lineno="42"><highlight class="comment"><sp/><sp/><sp/><sp/>THE<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>&quot;AS<sp/>IS&quot;,<sp/>WITHOUT<sp/>WARRANTY<sp/>OF<sp/>ANY<sp/>KIND,<sp/>EXPRESS<sp/>OR</highlight></codeline>
<codeline lineno="43"><highlight class="comment"><sp/><sp/><sp/><sp/>IMPLIED,<sp/>INCLUDING<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO<sp/>THE<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY,</highlight></codeline>
<codeline lineno="44"><highlight class="comment"><sp/><sp/><sp/><sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE<sp/>AND<sp/>NONINFRINGEMENT.<sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE</highlight></codeline>
<codeline lineno="45"><highlight class="comment"><sp/><sp/><sp/><sp/>AUTHORS<sp/>OR<sp/>COPYRIGHT<sp/>HOLDERS<sp/>BE<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>CLAIM,<sp/>DAMAGES<sp/>OR<sp/>OTHER</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/><sp/><sp/><sp/>LIABILITY,<sp/>WHETHER<sp/>IN<sp/>AN<sp/>ACTION<sp/>OF<sp/>CONTRACT,<sp/>TORT<sp/>OR<sp/>OTHERWISE,<sp/>ARISING<sp/>FROM,</highlight></codeline>
<codeline lineno="47"><highlight class="comment"><sp/><sp/><sp/><sp/>OUT<sp/>OF<sp/>OR<sp/>IN<sp/>CONNECTION<sp/>WITH<sp/>THE<sp/>SOFTWARE<sp/>OR<sp/>THE<sp/>USE<sp/>OR<sp/>OTHER<sp/>DEALINGS<sp/>IN<sp/>THE</highlight></codeline>
<codeline lineno="48"><highlight class="comment"><sp/><sp/><sp/><sp/>SOFTWARE.</highlight></codeline>
<codeline lineno="49"><highlight class="comment"></highlight></codeline>
<codeline lineno="50"><highlight class="comment"></highlight></codeline>
<codeline lineno="51"><highlight class="comment">DISCLAIMER:</highlight></codeline>
<codeline lineno="52"><highlight class="comment"></highlight></codeline>
<codeline lineno="53"><highlight class="comment"><sp/><sp/><sp/><sp/>This<sp/>software<sp/>is<sp/>supplied<sp/>&quot;AS<sp/>IS&quot;<sp/>without<sp/>any<sp/>warranties<sp/>and<sp/>support</highlight></codeline>
<codeline lineno="54"><highlight class="comment"></highlight></codeline>
<codeline lineno="55"><highlight class="comment">USAGE:</highlight></codeline>
<codeline lineno="56"><highlight class="comment"></highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>input<sp/>points<sp/>are<sp/>pruned<sp/>if</highlight></codeline>
<codeline lineno="58"><highlight class="comment"></highlight></codeline>
<codeline lineno="59"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>There<sp/>are<sp/>duplicates<sp/>points</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>input<sp/>points<sp/>are<sp/>outside<sp/>of<sp/>the<sp/>bounding<sp/>box</highlight></codeline>
<codeline lineno="61"><highlight class="comment"></highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>input<sp/>bounding<sp/>box<sp/>is<sp/>optional<sp/>(calculated<sp/>automatically)</highlight></codeline>
<codeline lineno="63"><highlight class="comment"></highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>input<sp/>domain<sp/>is<sp/>(-FLT_MAX,<sp/>FLT_MAX]<sp/>(for<sp/>floats)</highlight></codeline>
<codeline lineno="65"><highlight class="comment"></highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/><sp/><sp/><sp/>The<sp/>api<sp/>consists<sp/>of<sp/>these<sp/>functions:</highlight></codeline>
<codeline lineno="67"><highlight class="comment"></highlight></codeline>
<codeline lineno="68"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>jcv_diagram_generate(<sp/>int<sp/>num_points,<sp/>const<sp/>jcv_point*<sp/>points,<sp/>const<sp/>jcv_rect*<sp/>rect,<sp/>jcv_diagram*<sp/>diagram<sp/>);</highlight></codeline>
<codeline lineno="69"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>jcv_diagram_generate_useralloc(<sp/>int<sp/>num_points,<sp/>const<sp/>jcv_point*<sp/>points,<sp/>const<sp/>jcv_rect*<sp/>rect,<sp/>void*</highlight></codeline>
<codeline lineno="70"><highlight class="comment">userallocctx,<sp/>FJCVAllocFn<sp/>allocfn,<sp/>FJCVFreeFn<sp/>freefn,<sp/>jcv_diagram*<sp/>diagram<sp/>);<sp/>void<sp/>jcv_diagram_free(<sp/>jcv_diagram*</highlight></codeline>
<codeline lineno="71"><highlight class="comment">diagram<sp/>);</highlight></codeline>
<codeline lineno="72"><highlight class="comment"></highlight></codeline>
<codeline lineno="73"><highlight class="comment"><sp/><sp/><sp/><sp/>const<sp/>jcv_site*<sp/>jcv_diagram_get_sites(<sp/>const<sp/>jcv_diagram*<sp/>diagram<sp/>);</highlight></codeline>
<codeline lineno="74"><highlight class="comment"><sp/><sp/><sp/><sp/>const<sp/>jcv_edge*<sp/>jcv_diagram_get_edges(<sp/>const<sp/>jcv_diagram*<sp/>diagram<sp/>);</highlight></codeline>
<codeline lineno="75"><highlight class="comment"><sp/><sp/><sp/><sp/>const<sp/>jcv_edge*<sp/>jcv_diagram_get_next_edge(<sp/>const<sp/>jcv_edge*<sp/>edge<sp/>);</highlight></codeline>
<codeline lineno="76"><highlight class="comment"></highlight></codeline>
<codeline lineno="77"><highlight class="comment"><sp/><sp/><sp/><sp/>An<sp/>example<sp/>usage:</highlight></codeline>
<codeline lineno="78"><highlight class="comment"></highlight></codeline>
<codeline lineno="79"><highlight class="comment"><sp/><sp/><sp/><sp/>#define<sp/>JC_VORONOI_IMPLEMENTATION</highlight></codeline>
<codeline lineno="80"><highlight class="comment"><sp/><sp/><sp/><sp/>//<sp/>If<sp/>you<sp/>wish<sp/>to<sp/>use<sp/>doubles</highlight></codeline>
<codeline lineno="81"><highlight class="comment"><sp/><sp/><sp/><sp/>//#define<sp/>JCV_REAL_TYPE<sp/>double</highlight></codeline>
<codeline lineno="82"><highlight class="comment"><sp/><sp/><sp/><sp/>//#define<sp/>JCV_ATAN2<sp/>atan2</highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/><sp/><sp/><sp/>//#define<sp/>JCV_FLT_MAX<sp/>1.7976931348623157E+308</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/><sp/>#include<sp/>&quot;jc_voronoi.h&quot;</highlight></codeline>
<codeline lineno="85"><highlight class="comment"></highlight></codeline>
<codeline lineno="86"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>draw_edges(const<sp/>jcv_diagram*<sp/>diagram);</highlight></codeline>
<codeline lineno="87"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>draw_cells(const<sp/>jcv_diagram*<sp/>diagram);</highlight></codeline>
<codeline lineno="88"><highlight class="comment"></highlight></codeline>
<codeline lineno="89"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>generate_and_draw(int<sp/>numpoints,<sp/>const<sp/>jcv_point*<sp/>points)</highlight></codeline>
<codeline lineno="90"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_diagram<sp/>diagram;</highlight></codeline>
<codeline lineno="92"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(&amp;diagram,<sp/>0,<sp/>sizeof(jcv_diagram));</highlight></codeline>
<codeline lineno="93"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_diagram_generate(count,<sp/>points,<sp/>0,<sp/>&amp;diagram);</highlight></codeline>
<codeline lineno="94"><highlight class="comment"></highlight></codeline>
<codeline lineno="95"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>draw_edges(diagram);</highlight></codeline>
<codeline lineno="96"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>draw_cells(diagram);</highlight></codeline>
<codeline lineno="97"><highlight class="comment"></highlight></codeline>
<codeline lineno="98"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_diagram_free(<sp/>&amp;diagram<sp/>);</highlight></codeline>
<codeline lineno="99"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="comment"></highlight></codeline>
<codeline lineno="101"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>draw_edges(const<sp/>jcv_diagram*<sp/>diagram)</highlight></codeline>
<codeline lineno="102"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>all<sp/>you<sp/>need<sp/>are<sp/>the<sp/>edges</highlight></codeline>
<codeline lineno="104"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_edge*<sp/>edge<sp/>=<sp/>jcv_diagram_get_edges(<sp/>diagram<sp/>);</highlight></codeline>
<codeline lineno="105"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>while(<sp/>edge<sp/>)</highlight></codeline>
<codeline lineno="106"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>draw_line(edge-&gt;pos[0],<sp/>edge-&gt;pos[1]);</highlight></codeline>
<codeline lineno="108"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>edge<sp/>=<sp/>jcv_diagram_get_next_edge(edge);</highlight></codeline>
<codeline lineno="109"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="111"><highlight class="comment"></highlight></codeline>
<codeline lineno="112"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>draw_cells(const<sp/>jcv_diagram*<sp/>diagram)</highlight></codeline>
<codeline lineno="113"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>you<sp/>want<sp/>to<sp/>draw<sp/>triangles,<sp/>or<sp/>relax<sp/>the<sp/>diagram,</highlight></codeline>
<codeline lineno="115"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>you<sp/>can<sp/>iterate<sp/>over<sp/>the<sp/>sites<sp/>and<sp/>get<sp/>all<sp/>edges<sp/>easily</highlight></codeline>
<codeline lineno="116"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_site*<sp/>sites<sp/>=<sp/>jcv_diagram_get_sites(<sp/>diagram<sp/>);</highlight></codeline>
<codeline lineno="117"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for(<sp/>int<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>diagram-&gt;numsites;<sp/>++i<sp/>)</highlight></codeline>
<codeline lineno="118"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_site*<sp/>site<sp/>=<sp/>&amp;sites[i];</highlight></codeline>
<codeline lineno="120"><highlight class="comment"></highlight></codeline>
<codeline lineno="121"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_graphedge*<sp/>e<sp/>=<sp/>site-&gt;edges;</highlight></codeline>
<codeline lineno="122"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>while(<sp/>e<sp/>)</highlight></codeline>
<codeline lineno="123"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>draw_triangle(<sp/>site-&gt;p,<sp/>e-&gt;pos[0],<sp/>e-&gt;pos[1]);</highlight></codeline>
<codeline lineno="125"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>e<sp/>=<sp/>e-&gt;next;</highlight></codeline>
<codeline lineno="126"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="127"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="comment"></highlight></codeline>
<codeline lineno="130"><highlight class="comment"><sp/><sp/><sp/><sp/>//<sp/>Here<sp/>is<sp/>a<sp/>simple<sp/>example<sp/>of<sp/>how<sp/>to<sp/>do<sp/>the<sp/>relaxations<sp/>of<sp/>the<sp/>cells</highlight></codeline>
<codeline lineno="131"><highlight class="comment"><sp/><sp/><sp/><sp/>void<sp/>relax_points(const<sp/>jcv_diagram*<sp/>diagram,<sp/>jcv_point*<sp/>points)</highlight></codeline>
<codeline lineno="132"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_site*<sp/>sites<sp/>=<sp/>jcv_diagram_get_sites(diagram);</highlight></codeline>
<codeline lineno="134"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for(<sp/>int<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>diagram-&gt;numsites;<sp/>++i<sp/>)</highlight></codeline>
<codeline lineno="135"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_site*<sp/>site<sp/>=<sp/>&amp;sites[i];</highlight></codeline>
<codeline lineno="137"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_point<sp/>sum<sp/>=<sp/>site-&gt;p;</highlight></codeline>
<codeline lineno="138"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int<sp/>count<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="139"><highlight class="comment"></highlight></codeline>
<codeline lineno="140"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>jcv_graphedge*<sp/>edge<sp/>=<sp/>site-&gt;edges;</highlight></codeline>
<codeline lineno="141"><highlight class="comment"></highlight></codeline>
<codeline lineno="142"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>while(<sp/>edge<sp/>)</highlight></codeline>
<codeline lineno="143"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum.x<sp/>+=<sp/>edge-&gt;pos[0].x;</highlight></codeline>
<codeline lineno="145"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum.y<sp/>+=<sp/>edge-&gt;pos[0].y;</highlight></codeline>
<codeline lineno="146"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++count;</highlight></codeline>
<codeline lineno="147"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>edge<sp/>=<sp/>edge-&gt;next;</highlight></codeline>
<codeline lineno="148"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="comment"></highlight></codeline>
<codeline lineno="150"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>points[site-&gt;index].x<sp/>=<sp/>sum.x<sp/>/<sp/>count;</highlight></codeline>
<codeline lineno="151"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>points[site-&gt;index].y<sp/>=<sp/>sum.y<sp/>/<sp/>count;</highlight></codeline>
<codeline lineno="152"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="154"><highlight class="comment"></highlight></codeline>
<codeline lineno="155"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JC_VORONOI_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JC_VORONOI_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;assert.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stddef.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>__cplusplus</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;C&quot;</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_REAL_TYPE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170" refid="jc__voronoi_8h_1a4d86a41e250d5cb383e6e63eea4fe0c9" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_REAL_TYPE<sp/>float</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_ATAN2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174" refid="jc__voronoi_8h_1a3ae890190ce57d8824a9b2353504eea2" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_ATAN2(_Y_,<sp/>_X_)<sp/>atan2f(_Y_,<sp/>_X_)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_SQRT</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178" refid="jc__voronoi_8h_1afe69737cad28c5d558fe3cea50966e9b" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_SQRT(_X_)<sp/>sqrtf(_X_)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_PI</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182" refid="jc__voronoi_8h_1a48db6e7cc0b9a9a9a5ba3376a5191600" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_PI<sp/>3.14159265358979323846264338327950288f</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_FLT_MAX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186" refid="jc__voronoi_8h_1a2a69ca5cc2eadf70988d863847a87025" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_FLT_MAX<sp/>3.402823466e+38F</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>JCV_EDGE_INTERSECT_THRESHOLD</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190" refid="jc__voronoi_8h_1a1e885658896f71cb1c180c93776eb6df" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>JCV_EDGE_INTERSECT_THRESHOLD<sp/>1.0e-10F</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193" refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a4d86a41e250d5cb383e6e63eea4fe0c9" kindref="member">JCV_REAL_TYPE</ref><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>pack(push,<sp/>1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197" refid="struct__jcv__point" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__point" kindref="compound">_jcv_point</ref><sp/>{</highlight></codeline>
<codeline lineno="198" refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="199" refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="200" refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202" refid="struct__jcv__graphedge" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__graphedge" kindref="compound">_jcv_graphedge</ref><sp/>{</highlight></codeline>
<codeline lineno="203" refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__graphedge" kindref="compound">_jcv_graphedge</ref>*<sp/><ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="204" refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__edge" kindref="compound">_jcv_edge</ref>*<sp/><ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref>;</highlight></codeline>
<codeline lineno="205" refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__site" kindref="compound">_jcv_site</ref>*<sp/><ref refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" kindref="member">neighbor</ref>;</highlight></codeline>
<codeline lineno="206" refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[2];</highlight></codeline>
<codeline lineno="207" refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref>;</highlight></codeline>
<codeline lineno="208" refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210" refid="struct__jcv__site" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__site" kindref="compound">_jcv_site</ref><sp/>{</highlight></codeline>
<codeline lineno="211" refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>;</highlight></codeline>
<codeline lineno="212" refid="struct__jcv__site_1a9a1e21b7b574616ebc167322fce414a9" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="struct__jcv__site_1a9a1e21b7b574616ebc167322fce414a9" kindref="member">index</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Index<sp/>into<sp/>the<sp/>original<sp/>list<sp/>of<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/><ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;<sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>half<sp/>edges<sp/>owned<sp/>by<sp/>the<sp/>cell</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214" refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216" refid="struct__jcv__edge" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__edge" kindref="compound">_jcv_edge</ref><sp/>{</highlight></codeline>
<codeline lineno="217" refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__edge" kindref="compound">_jcv_edge</ref>*<sp/><ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="218" refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/><ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[2];</highlight></codeline>
<codeline lineno="219" refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[2];</highlight></codeline>
<codeline lineno="220" refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="221" refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="222" refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/><ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref>;</highlight></codeline>
<codeline lineno="223" refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225" refid="struct__jcv__rect" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__rect" kindref="compound">_jcv_rect</ref><sp/>{</highlight></codeline>
<codeline lineno="226" refid="struct__jcv__rect_1a72574eae9f12009fd339ecf1065ed2db" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__rect_1a72574eae9f12009fd339ecf1065ed2db" kindref="member">min</ref>;</highlight></codeline>
<codeline lineno="227" refid="struct__jcv__rect_1a16150970f1caf28961255bacf5ec6d22" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__rect_1a16150970f1caf28961255bacf5ec6d22" kindref="member">max</ref>;</highlight></codeline>
<codeline lineno="228" refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref>;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230" refid="struct__jcv__diagram" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct__jcv__diagram" kindref="compound">_jcv_diagram</ref><sp/>{</highlight></codeline>
<codeline lineno="231" refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_context_internal*<sp/><ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>;</highlight></codeline>
<codeline lineno="232" refid="struct__jcv__diagram_1a37cf2c70119c58752c0b61b2f113be7e" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/><ref refid="struct__jcv__diagram_1a37cf2c70119c58752c0b61b2f113be7e" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="233" refid="struct__jcv__diagram_1a4ae320fc804cccfcd4d46c0cf98cb150" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/><ref refid="struct__jcv__diagram_1a4ae320fc804cccfcd4d46c0cf98cb150" kindref="member">sites</ref>;</highlight></codeline>
<codeline lineno="234" refid="struct__jcv__diagram_1a6684510ae98f93978135c10a41ee5914" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="struct__jcv__diagram_1a6684510ae98f93978135c10a41ee5914" kindref="member">numsites</ref>;</highlight></codeline>
<codeline lineno="235" refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>;</highlight></codeline>
<codeline lineno="236" refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/><ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>;</highlight></codeline>
<codeline lineno="237" refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" refkind="member"><highlight class="normal">}<sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>pack(pop)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="246" refid="jc__voronoi_8h_1a06e41773fa0f60c5dd38ec8fd24ee44c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a06e41773fa0f60c5dd38ec8fd24ee44c" kindref="member">jcv_diagram_generate</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref>*<sp/>rect,<sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248" refid="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>(*FJCVAllocFn)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>userctx,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size);</highlight></codeline>
<codeline lineno="249" refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>void<sp/>(*<ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref>)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>userctx,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>p);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Same<sp/>as<sp/>above,<sp/>but<sp/>allows<sp/>the<sp/>client<sp/>to<sp/>use<sp/>a<sp/>custom<sp/>allocator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252" refid="jc__voronoi_8h_1a31d74234527a688f260a955dc9c5adfc" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a31d74234527a688f260a955dc9c5adfc" kindref="member">jcv_diagram_generate_useralloc</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref>*<sp/>rect,</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>userallocctx,<sp/><ref refid="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" kindref="member">FJCVAllocFn</ref><sp/>allocfn,<sp/><ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref><sp/>freefn,</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Uses<sp/>free<sp/>(or<sp/>the<sp/>registered<sp/>custom<sp/>free<sp/>function)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257" refid="jc__voronoi_8h_1a2be8cceedaa369c8568076f049b5d9fa" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a2be8cceedaa369c8568076f049b5d9fa" kindref="member">jcv_diagram_free</ref>(<ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Returns<sp/>an<sp/>array<sp/>of<sp/>sites,<sp/>where<sp/>each<sp/>index<sp/>is<sp/>the<sp/>same<sp/>as<sp/>the<sp/>original<sp/>input<sp/>point<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260" refid="jc__voronoi_8h_1a3f1f04b91dba62621ce99132ea03bdd5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/><ref refid="jc__voronoi_8h_1a3f1f04b91dba62621ce99132ea03bdd5" kindref="member">jcv_diagram_get_sites</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Returns<sp/>a<sp/>linked<sp/>list<sp/>of<sp/>all<sp/>the<sp/>voronoi<sp/>edges</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="comment">//<sp/>excluding<sp/>the<sp/>ones<sp/>that<sp/>lie<sp/>on<sp/>the<sp/>borders<sp/>of<sp/>the<sp/>bounding<sp/>box.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="comment">//<sp/>For<sp/>a<sp/>full<sp/>list<sp/>of<sp/>edges,<sp/>you<sp/>need<sp/>to<sp/>iterate<sp/>over<sp/>the<sp/>sites,<sp/>and<sp/>their<sp/>graph<sp/>edges.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265" refid="jc__voronoi_8h_1a6ed5fdcd8aa5764dae68f27f1ea152a6" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/><ref refid="jc__voronoi_8h_1a6ed5fdcd8aa5764dae68f27f1ea152a6" kindref="member">jcv_diagram_get_edges</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Iterates<sp/>over<sp/>a<sp/>list<sp/>of<sp/>edges,<sp/>skipping<sp/>invalid<sp/>edges<sp/>(where<sp/>p0==p1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268" refid="jc__voronoi_8h_1af42b092404285d28eeb2c2a119d5e8d7" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/><ref refid="jc__voronoi_8h_1af42b092404285d28eeb2c2a119d5e8d7" kindref="member">jcv_diagram_get_next_edge</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>__cplusplus</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal">}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/><sp/></highlight><highlight class="comment">//<sp/>JC_VORONOI_H</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>JC_VORONOI_IMPLEMENTATION</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;memory.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight><highlight class="comment">//<sp/>INTERNAL<sp/>FUNCTIONS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>defined(_MSC_VER)<sp/>&amp;&amp;<sp/>!defined(__cplusplus)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>inline<sp/>__inline</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight><highlight class="comment">//<sp/>jcv_point</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_point_cmp(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>p1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>p2)<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>s1<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*)p1;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>s2<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*)p2;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(s1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>!=<sp/>s2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>?<sp/>(s1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&lt;<sp/>s2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>?<sp/>-1<sp/>:<sp/>1)<sp/>:<sp/>(s1-&gt;x<sp/>&lt;<sp/>s2-&gt;x<sp/>?<sp/>-1<sp/>:<sp/>1);</highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_point_less(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt2)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(pt1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>pt2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>?<sp/>(pt1-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&lt;<sp/>pt2-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)<sp/>:<sp/>pt1-&gt;y<sp/>&lt;<sp/>pt2-&gt;y;</highlight></codeline>
<codeline lineno="296"><highlight class="normal">}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_point_eq(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt2)<sp/>{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(pt1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>pt2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>&amp;&amp;<sp/>(pt1-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>pt2-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="300"><highlight class="normal">}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_point_on_edge(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>min,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>max)<sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pt-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>min-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>||<sp/>pt-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>min-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>||<sp/>pt-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>max-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>||<sp/>pt-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>max-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="304"><highlight class="normal">}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_point_dist_sq(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt2)<sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>diffx<sp/>=<sp/>pt1-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>pt2-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>diffy<sp/>=<sp/>pt1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>pt2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>diffx<sp/>*<sp/>diffx<sp/>+<sp/>diffy<sp/>*<sp/>diffy;</highlight></codeline>
<codeline lineno="310"><highlight class="normal">}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_point_dist(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>pt2)<sp/>{</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)(<ref refid="jc__voronoi_8h_1afe69737cad28c5d558fe3cea50966e9b" kindref="member">JCV_SQRT</ref>(jcv_point_dist_sq(pt1,<sp/>pt2)));</highlight></codeline>
<codeline lineno="314"><highlight class="normal">}</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Structs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>pack(push,<sp/>1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_halfedge<sp/>{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_halfedge*<sp/>left;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_halfedge*<sp/>right;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>vertex;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>y;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>direction;<sp/><sp/></highlight><highlight class="comment">//<sp/>0=left,<sp/>1=right</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pqpos;</highlight></codeline>
<codeline lineno="328"><highlight class="normal">}<sp/>jcv_halfedge;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_memoryblock<sp/>{</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>sizefree;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_memoryblock*<sp/>next;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>memory;</highlight></codeline>
<codeline lineno="334"><highlight class="normal">}<sp/>jcv_memoryblock;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/>int<sp/>(*FJCVPriorityQueuePrint)(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>node,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_priorityqueue<sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Implements<sp/>a<sp/>binary<sp/>heap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>maxnumitems;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numitems;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">**<sp/>items;</highlight></codeline>
<codeline lineno="343"><highlight class="normal">}<sp/>jcv_priorityqueue;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">_jcv_context_internal<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>mem;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edges;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>beachline_start;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>beachline_end;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>last_inserted;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>jcv_priorityqueue*<sp/>eventqueue;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>sites;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>bottomsite;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numsites;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numsites_sqrt;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>currentsite;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>_padding;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/>jcv_memoryblock*<sp/>memblocks;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edgepool;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>halfedgepool;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">**<sp/>eventmem;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>memctx;<sp/><sp/></highlight><highlight class="comment">//<sp/>Given<sp/>by<sp/>the<sp/>user</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" kindref="member">FJCVAllocFn</ref><sp/><ref refid="mix_8h_1a4707176f2cd6eb4dc734fffb6cf10feb" kindref="member">alloc</ref>;</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref><sp/>free;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>min;</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>max;</highlight></codeline>
<codeline lineno="371"><highlight class="normal">}<sp/>jcv_context_internal;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>pack(pop)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>JCV_DIRECTION_LEFT<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>JCV_DIRECTION_RIGHT<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>JCV_INVALID_VALUE<sp/>=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)-<ref refid="jc__voronoi_8h_1a2a69ca5cc2eadf70988d863847a87025" kindref="member">JCV_FLT_MAX</ref>;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a2be8cceedaa369c8568076f049b5d9fa" kindref="member">jcv_diagram_free</ref>(<ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>d)<sp/>{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>jcv_context_internal*<sp/>internal<sp/>=<sp/>d-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>memctx<sp/>=<sp/>internal-&gt;memctx;</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref><sp/>freefn<sp/>=<sp/>internal-&gt;free;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(internal-&gt;memblocks)<sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_memoryblock*<sp/>p<sp/>=<sp/>internal-&gt;memblocks;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>internal-&gt;memblocks<sp/>=<sp/>internal-&gt;memblocks-&gt;next;</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>freefn(memctx,<sp/>p);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/>freefn(memctx,<sp/>internal-&gt;mem);</highlight></codeline>
<codeline lineno="390"><highlight class="normal">}</highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/><ref refid="jc__voronoi_8h_1a3f1f04b91dba62621ce99132ea03bdd5" kindref="member">jcv_diagram_get_sites</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>diagram-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>-&gt;sites;<sp/>}</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/><ref refid="jc__voronoi_8h_1a6ed5fdcd8aa5764dae68f27f1ea152a6" kindref="member">jcv_diagram_get_edges</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>diagram-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>-&gt;edges;<sp/>}</highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/><ref refid="jc__voronoi_8h_1af42b092404285d28eeb2c2a119d5e8d7" kindref="member">jcv_diagram_get_next_edge</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge)<sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e<sp/>=<sp/>edge-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>jcv_point_eq(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0],<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1]))<sp/>{</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>e;</highlight></codeline>
<codeline lineno="402"><highlight class="normal">}</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>jcv_alloc(jcv_context_internal*<sp/>internal,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!internal-&gt;memblocks<sp/>||<sp/>internal-&gt;memblocks-&gt;sizefree<sp/>&lt;<sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>blocksize<sp/>=<sp/>16<sp/>*<sp/>1024;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_memoryblock*<sp/>block<sp/>=<sp/>(jcv_memoryblock*)internal-&gt;alloc(internal-&gt;memctx,<sp/>blocksize);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>offset<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_memoryblock);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>block-&gt;sizefree<sp/>=<sp/>blocksize<sp/>-<sp/>offset;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/>block-&gt;next<sp/>=<sp/>internal-&gt;memblocks;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>block-&gt;memory<sp/>=<sp/>((</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)block)<sp/>+<sp/>offset;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>internal-&gt;memblocks<sp/>=<sp/>block;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>p<sp/>=<sp/>internal-&gt;memblocks-&gt;memory;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/>internal-&gt;memblocks-&gt;memory<sp/>+=<sp/>size;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/>internal-&gt;memblocks-&gt;sizefree<sp/>-=<sp/>size;</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="418"><highlight class="normal">}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>jcv_alloc_edge(jcv_context_internal*<sp/>internal)<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*)jcv_alloc(internal,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>));</highlight></codeline>
<codeline lineno="422"><highlight class="normal">}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>jcv_alloc_halfedge(jcv_context_internal*<sp/>internal)<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(internal-&gt;halfedgepool)<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_halfedge*<sp/>edge<sp/>=<sp/>internal-&gt;halfedgepool;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>internal-&gt;halfedgepool<sp/>=<sp/>internal-&gt;halfedgepool-&gt;right;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>edge;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(jcv_halfedge*)jcv_alloc(internal,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_halfedge));</highlight></codeline>
<codeline lineno="432"><highlight class="normal">}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>jcv_alloc_graphedge(jcv_context_internal*<sp/>internal)<sp/>{</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*)jcv_alloc(internal,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>));</highlight></codeline>
<codeline lineno="436"><highlight class="normal">}</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>jcv_alloc_fn(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>memctx,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>(void)memctx;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>malloc(size);</highlight></codeline>
<codeline lineno="441"><highlight class="normal">}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_free_fn(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>memctx,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>p)<sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/>(void)memctx;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/>free(p);</highlight></codeline>
<codeline lineno="446"><highlight class="normal">}</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight><highlight class="comment">//<sp/>jcv_edge</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_is_valid(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>p)<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>!=<sp/>JCV_INVALID_VALUE<sp/>||<sp/>p-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>!=<sp/>JCV_INVALID_VALUE)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="452"><highlight class="normal">}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_edge_create(<ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>s1,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>s2)<sp/>{</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[0]<sp/>=<sp/>s1;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]<sp/>=<sp/>s2;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>JCV_INVALID_VALUE;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>JCV_INVALID_VALUE;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>JCV_INVALID_VALUE;</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>JCV_INVALID_VALUE;</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>line<sp/>equation<sp/>between<sp/>S1<sp/>and<sp/>S2:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>a<sp/>=<sp/>-1<sp/>*<sp/>(s2-&gt;p.y<sp/>-<sp/>s1-&gt;p.y);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>b<sp/>=<sp/>s2-&gt;p.x<sp/>-<sp/>s1-&gt;p.x;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>//jcv_real<sp/>c<sp/>=<sp/>-1<sp/>*<sp/>(s2-&gt;p.x<sp/>-<sp/>s1-&gt;p.x)<sp/>*<sp/>s1-&gt;p.y<sp/>+<sp/>(s2-&gt;p.y<sp/>-<sp/>s1-&gt;p.y)<sp/>*<sp/>s1-&gt;p.x;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>//<sp/>create<sp/>perpendicular<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>pa<sp/>=<sp/>b;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>pb<sp/>=<sp/>-a;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>//jcv_real<sp/>pc<sp/>=<sp/>pa<sp/>*<sp/>s1-&gt;p.x<sp/>+<sp/>pb<sp/>*<sp/>s1-&gt;p.y;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>//<sp/>Move<sp/>to<sp/>the<sp/>mid<sp/>point</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>mx<sp/>=<sp/>s1-&gt;p.x<sp/>+<sp/>dx<sp/>*<sp/>jcv_real(0.5);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>my<sp/>=<sp/>s1-&gt;p.y<sp/>+<sp/>dy<sp/>*<sp/>jcv_real(0.5);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>jcv_real<sp/>pc<sp/>=<sp/>(<sp/>pa<sp/>*<sp/>mx<sp/>+<sp/>pb<sp/>*<sp/>my<sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>dx<sp/>=<sp/>s2-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>s1-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>dy<sp/>=<sp/>s2-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>s1-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dx_is_larger<sp/>=<sp/>(dx<sp/>*<sp/>dx)<sp/>&gt;<sp/>(dy<sp/>*<sp/>dy);<sp/><sp/></highlight><highlight class="comment">//<sp/>instead<sp/>of<sp/>fabs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Simplify<sp/>it,<sp/>using<sp/>dx<sp/>and<sp/>dy</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>=<sp/>dx<sp/>*<sp/>(s1-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>+<sp/>dx<sp/>*<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0.5)<sp/>+<sp/>dy<sp/>*<sp/>(s1-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>dy<sp/>*<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0.5);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(dx_is_larger)<sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>=<sp/>dy<sp/>/<sp/>dx;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>/=<sp/>dx;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>=<sp/>dx<sp/>/<sp/>dy;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>/=<sp/>dy;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="494"><highlight class="normal">}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_edge_clipline(<ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>min,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>max)<sp/>{</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>pxmin<sp/>=<sp/>min-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>pxmax<sp/>=<sp/>max-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>pymin<sp/>=<sp/>min-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>pymax<sp/>=<sp/>max-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>x1,<sp/>y1,<sp/>x2,<sp/>y2;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>s1;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>s2;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>==<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1<sp/>&amp;&amp;<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>&gt;=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0)<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/>s1<sp/>=<sp/>jcv_is_valid(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1])<sp/>?<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>s2<sp/>=<sp/>jcv_is_valid(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0])<sp/>?<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>s1<sp/>=<sp/>jcv_is_valid(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0])<sp/>?<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>s2<sp/>=<sp/>jcv_is_valid(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1])<sp/>?<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>==<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1)<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>pymin;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s1<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>s1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&gt;<sp/>pymin)<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>s1-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y1<sp/>&gt;<sp/>pymax)<sp/>{</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>pymax;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>y1;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>pymax;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s2<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>s2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&lt;<sp/>pymax)<sp/>y2<sp/>=<sp/>s2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y2<sp/>&lt;<sp/>pymin)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>pymin;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref>)<sp/>-<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>)<sp/>*<sp/>y2;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Never<sp/>occurs<sp/>according<sp/>to<sp/>lcov</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if(<sp/>((x1<sp/>&gt;<sp/>pxmax)<sp/>&amp;<sp/>(x2<sp/>&gt;<sp/>pxmax))<sp/>|<sp/>((x1<sp/>&lt;<sp/>pxmin)<sp/>&amp;<sp/>(x2<sp/>&lt;<sp/>pxmin))<sp/>)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>return<sp/>0;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x1<sp/>&gt;<sp/>pxmax)<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>pxmax;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>x1)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x1<sp/>&lt;<sp/>pxmin)<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>pxmin;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>x1)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x2<sp/>&gt;<sp/>pxmax)<sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>pxmax;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>x2)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x2<sp/>&lt;<sp/>pxmin)<sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>pxmin;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>x2)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>pxmin;</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s1<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>s1-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&gt;<sp/>pxmin)<sp/>x1<sp/>=<sp/>s1-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x1<sp/>&gt;<sp/>pxmax)<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>pxmax;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>*<sp/>x1;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>pxmax;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s2<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>s2-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&lt;<sp/>pxmax)<sp/>x2<sp/>=<sp/>s2-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x2<sp/>&lt;<sp/>pxmin)<sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>pxmin;</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>*<sp/>x2;</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Never<sp/>occurs<sp/>according<sp/>to<sp/>lcov</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if(<sp/>((y1<sp/>&gt;<sp/>pymax)<sp/>&amp;<sp/>(y2<sp/>&gt;<sp/>pymax))<sp/>|<sp/>((y1<sp/>&lt;<sp/>pymin)<sp/>&amp;<sp/>(y2<sp/>&lt;<sp/>pymin))<sp/>)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>return<sp/>0;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y1<sp/>&gt;<sp/>pymax)<sp/>{</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>pymax;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>y1)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y1<sp/>&lt;<sp/>pymin)<sp/>{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y1<sp/>=<sp/>pymin;</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x1<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>y1)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y2<sp/>&gt;<sp/>pymax)<sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>pymax;</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>y2)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y2<sp/>&lt;<sp/>pymin)<sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/>pymin;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>x2<sp/>=<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>y2)<sp/>/<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>x1;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>y1;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>x2;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>y2;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>two<sp/>points<sp/>are<sp/>equal,<sp/>the<sp/>result<sp/>is<sp/>invalid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(x1<sp/>==<sp/>x2<sp/>&amp;&amp;<sp/>y1<sp/>==<sp/>y2)<sp/>?<sp/>0<sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="589"><highlight class="normal">}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>jcv_edge_new(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>s1,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>s2)<sp/>{</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e<sp/>=<sp/>jcv_alloc_edge(internal);</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/>jcv_edge_create(e,<sp/>s1,<sp/>s2);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>e;</highlight></codeline>
<codeline lineno="595"><highlight class="normal">}</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight><highlight class="comment">//<sp/>jcv_halfedge</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_halfedge_link(jcv_halfedge*<sp/>edge,<sp/>jcv_halfedge*<sp/>newedge)<sp/>{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/>newedge-&gt;left<sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/>newedge-&gt;right<sp/>=<sp/>edge-&gt;right;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/>edge-&gt;right-&gt;left<sp/>=<sp/>newedge;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/>edge-&gt;right<sp/>=<sp/>newedge;</highlight></codeline>
<codeline lineno="604"><highlight class="normal">}</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_halfedge_unlink(jcv_halfedge*<sp/>he)<sp/>{</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/>he-&gt;left-&gt;right<sp/>=<sp/>he-&gt;right;</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/>he-&gt;right-&gt;left<sp/>=<sp/>he-&gt;left;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/>he-&gt;left<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/>he-&gt;right<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="611"><highlight class="normal">}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>jcv_halfedge_new(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>direction)<sp/>{</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>he<sp/>=<sp/>jcv_alloc_halfedge(internal);</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/>he-&gt;edge<sp/>=<sp/>e;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/>he-&gt;left<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/>he-&gt;right<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/>he-&gt;direction<sp/>=<sp/>direction;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/>he-&gt;pqpos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>These<sp/>are<sp/>set<sp/>outside</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>he-&gt;y</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>he-&gt;vertex</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>he;</highlight></codeline>
<codeline lineno="624"><highlight class="normal">}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_halfedge_delete(jcv_context_internal*<sp/>internal,<sp/>jcv_halfedge*<sp/>he)<sp/>{</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/>he-&gt;right<sp/>=<sp/>internal-&gt;halfedgepool;</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/>internal-&gt;halfedgepool<sp/>=<sp/>he;</highlight></codeline>
<codeline lineno="629"><highlight class="normal">}</highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>jcv_halfedge_leftsite(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>he-&gt;edge-&gt;sites[he-&gt;direction];<sp/>}</highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>jcv_halfedge_rightsite(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he)<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>he-&gt;edge<sp/>?<sp/>he-&gt;edge-&gt;sites[1<sp/>-<sp/>he-&gt;direction]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="635"><highlight class="normal">}</highlight></codeline>
<codeline lineno="636"><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_halfedge_rightof(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>p)<sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e<sp/>=<sp/>he-&gt;edge;</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>topsite<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1];</highlight></codeline>
<codeline lineno="640"><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>right_of_site<sp/>=<sp/>(p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&gt;<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(right_of_site<sp/>&amp;&amp;<sp/>he-&gt;direction<sp/>==<sp/>JCV_DIRECTION_LEFT)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!right_of_site<sp/>&amp;&amp;<sp/>he-&gt;direction<sp/>==<sp/>JCV_DIRECTION_RIGHT)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>dxp,<sp/>dyp,<sp/>dxs,<sp/>t1,<sp/>t2,<sp/>t3,<sp/>yl;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>above;</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>==<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1)<sp/>{</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/>dyp<sp/>=<sp/>p-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>dxp<sp/>=<sp/>p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fast<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((!right_of_site<sp/>&amp;<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>&lt;<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0))<sp/>|<sp/>(right_of_site<sp/>&amp;<sp/>(e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>&gt;=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0)))<sp/>{</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>above<sp/>=<sp/>dyp<sp/>&gt;=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>dxp;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fast<sp/>=<sp/>above;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>above<sp/>=<sp/>(p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>+<sp/>p-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>*<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>)<sp/>&gt;<sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref>;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>&lt;<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0)<sp/>above<sp/>=<sp/>!above;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!above)<sp/>fast<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!fast)<sp/>{</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dxs<sp/>=<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[0]-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>above<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>(dxp<sp/>*<sp/>dxp<sp/>-<sp/>dyp<sp/>*<sp/>dyp)<sp/>&lt;<sp/>dxs<sp/>*<sp/>dyp<sp/>*<sp/>((<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)1<sp/>+<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)2<sp/>*<sp/>dxp<sp/>/<sp/>dxs<sp/>+<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref>);</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>&lt;<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0)<sp/>above<sp/>=<sp/>!above;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>e-&gt;b<sp/>==<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/>yl<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>e-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>*<sp/>p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>t1<sp/>=<sp/>p-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>yl;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>t2<sp/>=<sp/>p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>t3<sp/>=<sp/>yl<sp/>-<sp/>topsite-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/>above<sp/>=<sp/>t1<sp/>*<sp/>t1<sp/>&gt;<sp/>(t2<sp/>*<sp/>t2<sp/>+<sp/>t3<sp/>*<sp/>t3);</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(he-&gt;direction<sp/>==<sp/>JCV_DIRECTION_LEFT<sp/>?<sp/>above<sp/>:<sp/>!above);</highlight></codeline>
<codeline lineno="674"><highlight class="normal">}</highlight></codeline>
<codeline lineno="675"><highlight class="normal"></highlight></codeline>
<codeline lineno="676"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Keeps<sp/>the<sp/>priority<sp/>queue<sp/>sorted<sp/>with<sp/>events<sp/>sorted<sp/>in<sp/>ascending<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Return<sp/>1<sp/>if<sp/>the<sp/>edges<sp/>needs<sp/>to<sp/>be<sp/>swapped</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_halfedge_compare(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he2)<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(he1-&gt;y<sp/>==<sp/>he2-&gt;y)<sp/>?<sp/>he1-&gt;vertex.x<sp/>&gt;<sp/>he2-&gt;vertex.x<sp/>:<sp/>he1-&gt;y<sp/>&gt;<sp/>he2-&gt;y;</highlight></codeline>
<codeline lineno="680"><highlight class="normal">}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_halfedge_intersect(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he2,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>out)<sp/>{</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e1<sp/>=<sp/>he1-&gt;edge;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e2<sp/>=<sp/>he2-&gt;edge;</highlight></codeline>
<codeline lineno="685"><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>d<sp/>=<sp/>e1-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>-<sp/>e1-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(((<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)-<ref refid="jc__voronoi_8h_1a1e885658896f71cb1c180c93776eb6df" kindref="member">JCV_EDGE_INTERSECT_THRESHOLD</ref><sp/>&lt;<sp/>d<sp/>&amp;&amp;<sp/>d<sp/>&lt;<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)<ref refid="jc__voronoi_8h_1a1e885658896f71cb1c180c93776eb6df" kindref="member">JCV_EDGE_INTERSECT_THRESHOLD</ref>))<sp/>{</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/>out-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>(e1-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>-<sp/>e1-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref>)<sp/>/<sp/>d;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/>out-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>(e1-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>-<sp/>e1-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>*<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref>)<sp/>/<sp/>d;</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e;</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he;</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_point_less(&amp;e1-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;e2-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>))<sp/>{</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>he<sp/>=<sp/>he1;</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>e1;</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/>he<sp/>=<sp/>he2;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>e2;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>right_of_site<sp/>=<sp/>out-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&gt;=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((right_of_site<sp/>&amp;&amp;<sp/>he-&gt;direction<sp/>==<sp/>JCV_DIRECTION_LEFT)<sp/>||</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(!right_of_site<sp/>&amp;&amp;<sp/>he-&gt;direction<sp/>==<sp/>JCV_DIRECTION_RIGHT))<sp/>{</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="710"><highlight class="normal">}</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Priority<sp/>queue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_pq_moveup(jcv_priorityqueue*<sp/>pq,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/>jcv_halfedge**<sp/>items<sp/>=<sp/>(jcv_halfedge**)pq-&gt;items;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>node<sp/>=<sp/>items[pos];</highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>parent<sp/>=<sp/>(pos<sp/>&gt;&gt;<sp/>1);<sp/>pos<sp/>&gt;<sp/>1<sp/>&amp;&amp;<sp/>jcv_halfedge_compare(items[parent],<sp/>node);</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos<sp/>=<sp/>parent,<sp/>parent<sp/>=<sp/>parent<sp/>&gt;&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>items[pos]<sp/>=<sp/>items[parent];</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>items[pos]-&gt;pqpos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/>node-&gt;pqpos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/>items[pos]<sp/>=<sp/>node;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pos;</highlight></codeline>
<codeline lineno="727"><highlight class="normal">}</highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_pq_maxchild(jcv_priorityqueue*<sp/>pq,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos)<sp/>{</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>child<sp/>=<sp/>pos<sp/>&lt;&lt;<sp/>1;</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(child<sp/>&gt;=<sp/>pq-&gt;numitems)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/>jcv_halfedge**<sp/>items<sp/>=<sp/>(jcv_halfedge**)pq-&gt;items;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((child<sp/>+<sp/>1)<sp/>&lt;<sp/>pq-&gt;numitems<sp/>&amp;&amp;<sp/>jcv_halfedge_compare(items[child],<sp/>items[child<sp/>+<sp/>1]))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>child<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>child;</highlight></codeline>
<codeline lineno="735"><highlight class="normal">}</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_pq_movedown(jcv_priorityqueue*<sp/>pq,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos)<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/>jcv_halfedge**<sp/>items<sp/>=<sp/>(jcv_halfedge**)pq-&gt;items;</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>node<sp/>=<sp/>items[pos];</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>child<sp/>=<sp/>jcv_pq_maxchild(pq,<sp/>pos);</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(child<sp/>&amp;&amp;<sp/>jcv_halfedge_compare(node,<sp/>items[child]))<sp/>{</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/>items[pos]<sp/>=<sp/>items[child];</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>items[pos]-&gt;pqpos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>pos<sp/>=<sp/>child;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>child<sp/>=<sp/>jcv_pq_maxchild(pq,<sp/>pos);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/>items[pos]<sp/>=<sp/>node;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/>items[pos]-&gt;pqpos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pos;</highlight></codeline>
<codeline lineno="752"><highlight class="normal">}</highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_pq_create(jcv_priorityqueue*<sp/>pq,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>capacity,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">**<sp/>buffer)<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/>pq-&gt;maxnumitems<sp/>=<sp/>capacity;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/>pq-&gt;numitems<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/>pq-&gt;items<sp/>=<sp/>buffer;</highlight></codeline>
<codeline lineno="758"><highlight class="normal">}</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_pq_empty(jcv_priorityqueue*<sp/>pq)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pq-&gt;numitems<sp/>==<sp/>1<sp/>?<sp/>1<sp/>:<sp/>0;<sp/>}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_pq_push(jcv_priorityqueue*<sp/>pq,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/>assert(pq-&gt;numitems<sp/>&lt;<sp/>pq-&gt;maxnumitems);</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>pq-&gt;numitems++;</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/>pq-&gt;items[n]<sp/>=<sp/>node;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>jcv_pq_moveup(pq,<sp/>n);</highlight></codeline>
<codeline lineno="767"><highlight class="normal">}</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>jcv_pq_pop(jcv_priorityqueue*<sp/>pq)<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>node<sp/>=<sp/>pq-&gt;items[1];</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/>pq-&gt;items[1]<sp/>=<sp/>pq-&gt;items[--pq-&gt;numitems];</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/>jcv_pq_movedown(pq,<sp/>1);</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>node;</highlight></codeline>
<codeline lineno="774"><highlight class="normal">}</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>jcv_pq_top(jcv_priorityqueue*<sp/>pq)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pq-&gt;items[1];<sp/>}</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_pq_remove(jcv_priorityqueue*<sp/>pq,<sp/>jcv_halfedge*<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pq-&gt;numitems<sp/>==<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos<sp/>=<sp/>node-&gt;pqpos;</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pos<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/>jcv_halfedge**<sp/>items<sp/>=<sp/>(jcv_halfedge**)pq-&gt;items;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/>items[pos]<sp/>=<sp/>items[--pq-&gt;numitems];</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_halfedge_compare(node,<sp/>items[pos]))</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_moveup(pq,<sp/>pos);</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_movedown(pq,<sp/>pos);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/>node-&gt;pqpos<sp/>=<sp/>pos;</highlight></codeline>
<codeline lineno="791"><highlight class="normal">}</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight><highlight class="comment">//<sp/>internal<sp/>functions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"></highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>jcv_nextsite(jcv_context_internal*<sp/>internal)<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(internal-&gt;currentsite<sp/>&lt;<sp/>internal-&gt;numsites)<sp/>?<sp/>&amp;internal-&gt;sites[internal-&gt;currentsite++]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="797"><highlight class="normal">}</highlight></codeline>
<codeline lineno="798"><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>jcv_get_edge_above_x(jcv_context_internal*<sp/>internal,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>p)<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Gets<sp/>the<sp/>arc<sp/>on<sp/>the<sp/>beach<sp/>line<sp/>at<sp/>the<sp/>x<sp/>coordinate<sp/>(i.e.<sp/>right<sp/>above<sp/>the<sp/>new<sp/>site<sp/>event)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>good<sp/>guess<sp/>it&apos;s<sp/>close<sp/>by<sp/>(Can<sp/>be<sp/>optimized)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>he<sp/>=<sp/>internal-&gt;last_inserted;</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!he)<sp/>{</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&lt;<sp/>(internal-&gt;max.x<sp/>-<sp/>internal-&gt;min.x)<sp/>/<sp/>2)</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>he<sp/>=<sp/>internal-&gt;beachline_start;</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>he<sp/>=<sp/>internal-&gt;beachline_end;</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="810"><highlight class="normal"></highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(he<sp/>==<sp/>internal-&gt;beachline_start<sp/>||<sp/>(he<sp/>!=<sp/>internal-&gt;beachline_end<sp/>&amp;&amp;<sp/>jcv_halfedge_rightof(he,<sp/>p)))<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>he<sp/>=<sp/>he-&gt;right;</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(he<sp/>!=<sp/>internal-&gt;beachline_end<sp/>&amp;&amp;<sp/>jcv_halfedge_rightof(he,<sp/>p));</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/>he<sp/>=<sp/>he-&gt;left;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>he<sp/>=<sp/>he-&gt;left;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(he<sp/>!=<sp/>internal-&gt;beachline_start<sp/>&amp;&amp;<sp/>!jcv_halfedge_rightof(he,<sp/>p));</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>he;</highlight></codeline>
<codeline lineno="825"><highlight class="normal">}</highlight></codeline>
<codeline lineno="826"><highlight class="normal"></highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>jcv_check_circle_event(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he1,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>jcv_halfedge*<sp/>he2,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>vertex)<sp/>{</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e1<sp/>=<sp/>he1-&gt;edge;</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e2<sp/>=<sp/>he2-&gt;edge;</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e1<sp/>==<sp/>0<sp/>||<sp/>e2<sp/>==<sp/>0<sp/>||<sp/>e1-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]<sp/>==<sp/>e2-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1])<sp/>{</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>jcv_halfedge_intersect(he1,<sp/>he2,<sp/>vertex);</highlight></codeline>
<codeline lineno="835"><highlight class="normal">}</highlight></codeline>
<codeline lineno="836"><highlight class="normal"></highlight></codeline>
<codeline lineno="837"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_site_event(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site)<sp/>{</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>left<sp/>=<sp/>jcv_get_edge_above_x(internal,<sp/>&amp;site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>);</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>right<sp/>=<sp/>left-&gt;right;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>bottom<sp/>=<sp/>jcv_halfedge_rightsite(left);</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!bottom)<sp/>bottom<sp/>=<sp/>internal-&gt;bottomsite;</highlight></codeline>
<codeline lineno="842"><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge<sp/>=<sp/>jcv_edge_new(internal,<sp/>bottom,<sp/>site);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref><sp/>=<sp/>internal-&gt;edges;</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/>internal-&gt;edges<sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="846"><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>edge1<sp/>=<sp/>jcv_halfedge_new(internal,<sp/>edge,<sp/>JCV_DIRECTION_LEFT);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>edge2<sp/>=<sp/>jcv_halfedge_new(internal,<sp/>edge,<sp/>JCV_DIRECTION_RIGHT);</highlight></codeline>
<codeline lineno="849"><highlight class="normal"></highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/>jcv_halfedge_link(left,<sp/>edge1);</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/>jcv_halfedge_link(edge1,<sp/>edge2);</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/>internal-&gt;last_inserted<sp/>=<sp/>right;</highlight></codeline>
<codeline lineno="854"><highlight class="normal"></highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>p;</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_check_circle_event(left,<sp/>edge1,<sp/>&amp;p))<sp/>{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_remove(internal-&gt;eventqueue,<sp/>left);</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/>left-&gt;vertex<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/>left-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>p.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>jcv_point_dist(&amp;site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;p);</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_push(internal-&gt;eventqueue,<sp/>left);</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_check_circle_event(edge2,<sp/>right,<sp/>&amp;p))<sp/>{</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/>edge2-&gt;vertex<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/>edge2-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>p.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>jcv_point_dist(&amp;site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;p);</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_push(internal-&gt;eventqueue,<sp/>edge2);</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="867"><highlight class="normal">}</highlight></codeline>
<codeline lineno="868"><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"></highlight><highlight class="comment">//<sp/>https://cp-algorithms.com/geometry/oriented-triangle-area.html</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_determinant(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>b,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>c)<sp/>{</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(b-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>a-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)<sp/>*<sp/>(c-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>a-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>-<sp/>(b-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-<sp/>a-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>*<sp/>(c-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-<sp/>a-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="872"><highlight class="normal">}</highlight></codeline>
<codeline lineno="873"><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_calc_sort_metric(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>edge)<sp/>{</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>take<sp/>the<sp/>average<sp/>of<sp/>the<sp/>two<sp/>points,<sp/>since<sp/>we<sp/>can<sp/>better<sp/>distinguish<sp/>between<sp/>very<sp/>small<sp/>edges</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>half<sp/>=<sp/>1<sp/>/<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)2;</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>x<sp/>=<sp/>(edge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>+<sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)<sp/>*<sp/>half;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>y<sp/>=<sp/>(edge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>*<sp/>half;</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>diffy<sp/>=<sp/>y<sp/>-<sp/>site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>angle<sp/>=<sp/><ref refid="jc__voronoi_8h_1a3ae890190ce57d8824a9b2353504eea2" kindref="member">JCV_ATAN2</ref>(diffy,<sp/>x<sp/>-<sp/>site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(diffy<sp/>&lt;<sp/>0)<sp/>angle<sp/>=<sp/>angle<sp/>+<sp/>2<sp/>*<sp/><ref refid="jc__voronoi_8h_1a48db6e7cc0b9a9a9a5ba3376a5191600" kindref="member">JCV_PI</ref>;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)angle;</highlight></codeline>
<codeline lineno="883"><highlight class="normal">}</highlight></codeline>
<codeline lineno="884"><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_sortedges_insert(<ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site,<sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>edge)<sp/>{</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Special<sp/>case<sp/>for<sp/>the<sp/>head<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref><sp/>==<sp/>0<sp/>||<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>&gt;=<sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref>)<sp/>{</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref><sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Locate<sp/>the<sp/>node<sp/>before<sp/>the<sp/>point<sp/>of<sp/>insertion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>current<sp/>=<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>&lt;<sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref>)<sp/>{</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>current<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/>edge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="899"><highlight class="normal">}</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_finishline(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!jcv_edge_clipline(e,<sp/>&amp;internal-&gt;min,<sp/>&amp;internal-&gt;max))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>graph<sp/>edges<sp/>are<sp/>CCW</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>flip<sp/>=<sp/>jcv_determinant(&amp;e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[0]-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0],<sp/>&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1])<sp/>&gt;<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)0<sp/>?<sp/>0<sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>ge<sp/>=<sp/>jcv_alloc_graphedge(internal);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref><sp/>=<sp/>e;</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" kindref="member">neighbor</ref><sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1<sp/>-<sp/>i];</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[flip]<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[i];</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1<sp/>-<sp/>flip]<sp/>=<sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1<sp/>-<sp/>i];</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>=<sp/>jcv_calc_sort_metric(e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[i],<sp/>ge);</highlight></codeline>
<codeline lineno="916"><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_sortedges_insert(e-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[i],<sp/>ge);</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>that<sp/>we<sp/>didn&apos;t<sp/>accidentally<sp/>add<sp/>a<sp/>duplicate<sp/>(rare),<sp/>then<sp/>remove<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>&amp;&amp;<sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>==<sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref>)<sp/>{</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_point_eq(&amp;ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0],<sp/>&amp;ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0])<sp/>&amp;&amp;<sp/>jcv_point_eq(&amp;ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1],<sp/>&amp;ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1]))<sp/>{</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;<sp/><sp/></highlight><highlight class="comment">//<sp/>Throw<sp/>it<sp/>away,<sp/>they&apos;re<sp/>so<sp/>few<sp/>anyways</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="926"><highlight class="normal">}</highlight></codeline>
<codeline lineno="927"><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_endpos(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>e,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>p,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>direction)<sp/>{</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[direction]<sp/>=<sp/>*p;</highlight></codeline>
<codeline lineno="930"><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!jcv_is_valid(&amp;e-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1<sp/>-<sp/>direction]))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="932"><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/>jcv_finishline(internal,<sp/>e);</highlight></codeline>
<codeline lineno="934"><highlight class="normal">}</highlight></codeline>
<codeline lineno="935"><highlight class="normal"></highlight></codeline>
<codeline lineno="936"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_create_corner_edge(jcv_context_internal*<sp/>internal,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site,<sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>current,</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>gap)<sp/>{</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" kindref="member">neighbor</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0]<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1];</highlight></codeline>
<codeline lineno="940"><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&lt;<sp/>internal-&gt;max.x<sp/>&amp;&amp;<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>internal-&gt;min.y)<sp/>{</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>internal-&gt;max.x;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>internal-&gt;min.y;</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&gt;<sp/>internal-&gt;min.x<sp/>&amp;&amp;<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>internal-&gt;max.y)<sp/>{</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>internal-&gt;min.x;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>internal-&gt;max.y;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&gt;<sp/>internal-&gt;min.y<sp/>&amp;&amp;<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>internal-&gt;min.x)<sp/>{</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>internal-&gt;min.x;</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>internal-&gt;min.y;</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&lt;<sp/>internal-&gt;max.y<sp/>&amp;&amp;<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>internal-&gt;max.x)<sp/>{</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>internal-&gt;max.x;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>internal-&gt;max.y;</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="954"><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>=<sp/>jcv_calc_sort_metric(site,<sp/>gap);</highlight></codeline>
<codeline lineno="956"><highlight class="normal">}</highlight></codeline>
<codeline lineno="957"><highlight class="normal"></highlight></codeline>
<codeline lineno="958"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>jcv_create_gap_edge(jcv_context_internal*<sp/>internal,<sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site,<sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>ge)<sp/>{</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge<sp/>=<sp/>jcv_alloc_edge(internal);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[0]<sp/>=<sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0];</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1a184b5a86b5e25e4c2b076b10ee793fc9" kindref="member">pos</ref>[1]<sp/>=<sp/>ge-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1];</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[0]<sp/>=<sp/>site;</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1a64fb84dfa26fa245e405b958e4f3dbb6" kindref="member">sites</ref>[1]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1a645614bbf65fb900b46db206647f3b28" kindref="member">a</ref><sp/>=<sp/>edge-&gt;<ref refid="struct__jcv__edge_1a6a7e4678d87a31e6fc79dcbb5099d49c" kindref="member">b</ref><sp/>=<sp/>edge-&gt;<ref refid="struct__jcv__edge_1a27038048c5bdbd5cc3ce936bba634960" kindref="member">c</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref><sp/>=<sp/>internal-&gt;edges;</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/>internal-&gt;edges<sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>edge;</highlight></codeline>
<codeline lineno="968"><highlight class="normal">}</highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Since<sp/>the<sp/>algorithm<sp/>leaves<sp/>gaps<sp/>at<sp/>the<sp/>borders/corner,<sp/>we<sp/>want<sp/>to<sp/>fill<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_fillgaps(<ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>diagram)<sp/>{</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/>jcv_context_internal*<sp/>internal<sp/>=<sp/>diagram-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>;</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>internal-&gt;numsites;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site<sp/>=<sp/>&amp;internal-&gt;sites[i];</highlight></codeline>
<codeline lineno="975"><highlight class="normal"></highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>They&apos;re<sp/>sorted<sp/>CCW,<sp/>so<sp/>if<sp/>the<sp/>current-&gt;pos[1]<sp/>!=<sp/>next-&gt;pos[0],<sp/>then<sp/>we<sp/>have<sp/>a<sp/>gap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>current<sp/>=<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!current)<sp/>{</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>edges,<sp/>then<sp/>it<sp/>should<sp/>be<sp/>a<sp/>single<sp/>cell</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>assert(internal-&gt;numsites<sp/>==<sp/>1);</highlight></codeline>
<codeline lineno="981"><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>gap<sp/>=<sp/>jcv_alloc_graphedge(internal);</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" kindref="member">neighbor</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0]<sp/>=<sp/>internal-&gt;min;</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>internal-&gt;max.x;</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>internal-&gt;min.y;</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>=<sp/>jcv_calc_sort_metric(site,<sp/>gap);</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref><sp/>=<sp/>jcv_create_gap_edge(internal,<sp/>site,<sp/>gap);</highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>current<sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref><sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="994"><highlight class="normal"></highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>next<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!next)<sp/>{</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>one<sp/>edge,<sp/>then<sp/>we<sp/>assume<sp/>it&apos;s<sp/>a<sp/>corner<sp/>gap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>gap<sp/>=<sp/>jcv_alloc_graphedge(internal);</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>jcv_create_corner_edge(internal,<sp/>site,<sp/>current,<sp/>gap);</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref><sp/>=<sp/>jcv_create_gap_edge(internal,<sp/>site,<sp/>gap);</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>current<sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>next<sp/>=<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(current<sp/>&amp;&amp;<sp/>next)<sp/>{</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_point_on_edge(&amp;current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1],<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>,<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!jcv_point_eq(&amp;current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1],<sp/>&amp;next-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0]))<sp/>{</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Border<sp/>gap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>==<sp/>next-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>||<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>==<sp/>next-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>gap<sp/>=<sp/>jcv_alloc_graphedge(internal);</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1acd5d8687a0737b73df963967da7d0e86" kindref="member">neighbor</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0]<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1];</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1]<sp/>=<sp/>next-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0];</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a609a99341004843f7a9af639015e3404" kindref="member">angle</ref><sp/>=<sp/>jcv_calc_sort_metric(site,<sp/>gap);</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref><sp/>=<sp/>jcv_create_gap_edge(internal,<sp/>site,<sp/>gap);</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_point_on_edge(&amp;current-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[1],<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>,<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_point_on_edge(&amp;next-&gt;<ref refid="struct__jcv__graphedge_1aa471bf8739860ecfa6c56343ee33eff3" kindref="member">pos</ref>[0],<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>,<sp/>&amp;diagram-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a2eb469b4802dbc3964403c88c4c2cbd6" kindref="member">jcv_graphedge</ref>*<sp/>gap<sp/>=<sp/>jcv_alloc_graphedge(internal);</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jcv_create_corner_edge(internal,<sp/>site,<sp/>current,<sp/>gap);</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1a9c14a395e04edecf0cca0c0ff6710a66" kindref="member">edge</ref><sp/>=<sp/>jcv_create_gap_edge(internal,<sp/>site,<sp/>gap);</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>gap-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref><sp/>=<sp/>gap;</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>something<sp/>went<sp/>wrong,<sp/>abort<sp/>instead<sp/>of<sp/>looping<sp/>indefinitely</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>current<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current)<sp/>{</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>next<sp/>=<sp/>current-&gt;<ref refid="struct__jcv__graphedge_1af097be4c7e9e6aa177fe34e1efb9e62d" kindref="member">next</ref>;</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!next)<sp/>next<sp/>=<sp/>site-&gt;<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref>;</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1042"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"></highlight></codeline>
<codeline lineno="1044"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>jcv_circle_event(jcv_context_internal*<sp/>internal)<sp/>{</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>left<sp/>=<sp/>(jcv_halfedge*)jcv_pq_pop(internal-&gt;eventqueue);</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>leftleft<sp/>=<sp/>left-&gt;left;</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>right<sp/>=<sp/>left-&gt;right;</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>rightright<sp/>=<sp/>right-&gt;right;</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>bottom<sp/>=<sp/>jcv_halfedge_leftsite(left);</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>top<sp/>=<sp/>jcv_halfedge_rightsite(right);</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"></highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>vertex<sp/>=<sp/>left-&gt;vertex;</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/>jcv_endpos(internal,<sp/>left-&gt;edge,<sp/>&amp;vertex,<sp/>left-&gt;direction);</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/>jcv_endpos(internal,<sp/>right-&gt;edge,<sp/>&amp;vertex,<sp/>right-&gt;direction);</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/>internal-&gt;last_inserted<sp/>=<sp/>rightright;</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/>jcv_pq_remove(internal-&gt;eventqueue,<sp/>right);</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/>jcv_halfedge_unlink(left);</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/>jcv_halfedge_unlink(right);</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/>jcv_halfedge_delete(internal,<sp/>left);</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/>jcv_halfedge_delete(internal,<sp/>right);</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"></highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>direction<sp/>=<sp/>JCV_DIRECTION_LEFT;</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bottom-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&gt;<sp/>top-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>temp<sp/>=<sp/>bottom;</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/>bottom<sp/>=<sp/>top;</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/>top<sp/>=<sp/>temp;</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>JCV_DIRECTION_RIGHT;</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"></highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a6a5b54b91e64e7464b9e5867eaad3b5b" kindref="member">jcv_edge</ref>*<sp/>edge<sp/>=<sp/>jcv_edge_new(internal,<sp/>bottom,<sp/>top);</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/>edge-&gt;<ref refid="struct__jcv__edge_1aa0c0dd1f7301167e856b9b6e73299519" kindref="member">next</ref><sp/>=<sp/>internal-&gt;edges;</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/>internal-&gt;edges<sp/>=<sp/>edge;</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"></highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/>jcv_halfedge*<sp/>he<sp/>=<sp/>jcv_halfedge_new(internal,<sp/>edge,<sp/>direction);</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/>jcv_halfedge_link(leftleft,<sp/>he);</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/>jcv_endpos(internal,<sp/>edge,<sp/>&amp;vertex,<sp/>JCV_DIRECTION_RIGHT<sp/>-<sp/>direction);</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>p;</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_check_circle_event(leftleft,<sp/>he,<sp/>&amp;p))<sp/>{</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_remove(internal-&gt;eventqueue,<sp/>leftleft);</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/>leftleft-&gt;vertex<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>leftleft-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>p.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>jcv_point_dist(&amp;bottom-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;p);</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_push(internal-&gt;eventqueue,<sp/>leftleft);</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(jcv_check_circle_event(he,<sp/>rightright,<sp/>&amp;p))<sp/>{</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/>he-&gt;vertex<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/>he-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>p.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+<sp/>jcv_point_dist(&amp;bottom-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;p);</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_pq_push(internal-&gt;eventqueue,<sp/>he);</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1093"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"></highlight></codeline>
<codeline lineno="1095"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_floor(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>v)<sp/>{</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>i<sp/>=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)v;</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>i)<sp/>?<sp/>i<sp/>-<sp/>1<sp/>:<sp/>i;</highlight></codeline>
<codeline lineno="1098"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>jcv_ceil(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>v)<sp/>{</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref><sp/>i<sp/>=<sp/>(<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)v;</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(v<sp/>&gt;<sp/>i)<sp/>?<sp/>i<sp/>+<sp/>1<sp/>:<sp/>i;</highlight></codeline>
<codeline lineno="1103"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>_jcv_calc_bounds(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>points,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>min,<sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>max)<sp/>{</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>_min<sp/>=<sp/>points[0];</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>_max<sp/>=<sp/>points[0];</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>num_points;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points[i].x<sp/>&lt;<sp/>_min.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_min.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>points[i].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points[i].x<sp/>&gt;<sp/>_max.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>)</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_max.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>points[i].<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"></highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points[i].y<sp/>&lt;<sp/>_min.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_min.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>points[i].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(points[i].y<sp/>&gt;<sp/>_max.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>_max.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>points[i].<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/>min-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>jcv_floor(_min.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/>min-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>jcv_floor(_min.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/>max-&gt;<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>jcv_ceil(_max.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref>);</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/>max-&gt;<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>jcv_ceil(_max.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>);</highlight></codeline>
<codeline lineno="1123"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a06e41773fa0f60c5dd38ec8fd24ee44c" kindref="member">jcv_diagram_generate</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref>*<sp/>rect,<sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>d)<sp/>{</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a31d74234527a688f260a955dc9c5adfc" kindref="member">jcv_diagram_generate_useralloc</ref>(num_points,<sp/>points,<sp/>rect,<sp/>0,<sp/>jcv_alloc_fn,<sp/>jcv_free_fn,<sp/>d);</highlight></codeline>
<codeline lineno="1127"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">_jcv_cast_align_struct<sp/>{</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>charp;</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">**<sp/>voidpp;</highlight></codeline>
<codeline lineno="1132"><highlight class="normal">}<sp/>jcv_cast_align_struct;</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"></highlight></codeline>
<codeline lineno="1134"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a31d74234527a688f260a955dc9c5adfc" kindref="member">jcv_diagram_generate_useralloc</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num_points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref>*<sp/>points,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1ad73f6c9ed27e703eef139c6ed7bb0479" kindref="member">jcv_rect</ref>*<sp/>rect,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>userallocctx,</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1af61e6ea8053a82cc992c24c23d82b920" kindref="member">FJCVAllocFn</ref><sp/>allocfn,<sp/><ref refid="jc__voronoi_8h_1ac02fb2bffd328442d958687d886a69ef" kindref="member">FJCVFreeFn</ref><sp/>freefn,<sp/><ref refid="jc__voronoi_8h_1aeb321df6f04b664ead5d9009d2557c05" kindref="member">jcv_diagram</ref>*<sp/>d)<sp/>{</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(d-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref>)<sp/><ref refid="jc__voronoi_8h_1a2be8cceedaa369c8568076f049b5d9fa" kindref="member">jcv_diagram_free</ref>(d);</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>max_num_events<sp/>=<sp/>num_points<sp/>*<sp/>2;<sp/><sp/></highlight><highlight class="comment">//<sp/>beachline<sp/>can<sp/>have<sp/>max<sp/>2*n-5<sp/>parabolas</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>sitessize<sp/>=<sp/>(size_t)num_points<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>);</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>memsize<sp/>=<sp/>8u<sp/>+<sp/>(size_t)max_num_events<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)<sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_priorityqueue)<sp/>+<sp/>sitessize<sp/>+</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_context_internal);</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"></highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>originalmem<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)allocfn(userallocctx,<sp/>memsize);</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/>memset(originalmem,<sp/>0,<sp/>memsize);</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"></highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>align<sp/>memory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>mem<sp/>=<sp/>originalmem<sp/>+<sp/>8<sp/>-<sp/>((size_t)(originalmem)&amp;0x7);</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"></highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/>jcv_context_internal*<sp/>internal<sp/>=<sp/>(jcv_context_internal*)mem;</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/>mem<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_context_internal);</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"></highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/>internal-&gt;mem<sp/>=<sp/>originalmem;</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/>internal-&gt;memctx<sp/>=<sp/>userallocctx;</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/>internal-&gt;alloc<sp/>=<sp/>allocfn;</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/>internal-&gt;free<sp/>=<sp/>freefn;</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"></highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_start<sp/>=<sp/>jcv_halfedge_new(internal,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_end<sp/>=<sp/>jcv_halfedge_new(internal,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"></highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_start-&gt;left<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_start-&gt;right<sp/>=<sp/>internal-&gt;beachline_end;</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_end-&gt;left<sp/>=<sp/>internal-&gt;beachline_start;</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/>internal-&gt;beachline_end-&gt;right<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"></highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/>internal-&gt;last_inserted<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"></highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/>internal-&gt;sites<sp/>=<sp/>(<ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*)mem;</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/>mem<sp/>+=<sp/>sitessize;</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/>internal-&gt;eventqueue<sp/>=<sp/>(jcv_priorityqueue*)mem;</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/>mem<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(jcv_priorityqueue);</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"></highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/>jcv_cast_align_struct<sp/>tmp;</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/>tmp.charp<sp/>=<sp/>mem;</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/>internal-&gt;eventmem<sp/>=<sp/>tmp.voidpp;</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"></highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rect<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/>_jcv_calc_bounds(num_points,<sp/>points,<sp/>&amp;d-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>,<sp/>&amp;d-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>);</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>-=<sp/>10;</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>-=<sp/>10;</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>+=<sp/>10;</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>+=<sp/>10;</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref><sp/>=<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a72574eae9f12009fd339ecf1065ed2db" kindref="member">min</ref>;</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref><sp/>=<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a16150970f1caf28961255bacf5ec6d22" kindref="member">max</ref>;</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/>internal-&gt;min<sp/>=<sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa399b45ddd3f8fad587b128d17a0f1a1" kindref="member">min</ref>;</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/>internal-&gt;max<sp/>=<sp/>d-&gt;<ref refid="struct__jcv__diagram_1aa9e598b93f68c6297f7f405d4d240c4c" kindref="member">max</ref>;</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"></highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/>jcv_pq_create(internal-&gt;eventqueue,<sp/>max_num_events,<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">**)internal-&gt;eventmem);</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"></highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>sites<sp/>=<sp/>internal-&gt;sites;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"></highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_points;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/>sites[i].<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref><sp/>=<sp/>points[i];</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/>sites[i].<ref refid="struct__jcv__site_1a66bedf58384b9c116b625faf5f76c660" kindref="member">edges</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/>sites[i].<ref refid="struct__jcv__site_1a9a1e21b7b574616ebc167322fce414a9" kindref="member">index</ref><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"></highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/>qsort(sites,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)num_points,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>),<sp/>jcv_point_cmp);</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"></highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>num_points;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>s<sp/>=<sp/>&amp;sites[i];</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>duplicates,<sp/>to<sp/>avoid<sp/>anomalies</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>jcv_point_eq(&amp;s-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;sites[i<sp/>-<sp/>1].p))<sp/>{</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>offset++;</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>points<sp/>outside<sp/>of<sp/>the<sp/>bounding<sp/>box<sp/>to<sp/>avoid<sp/>bad<sp/>edge<sp/>clipping<sp/>later<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rect<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&lt;<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a72574eae9f12009fd339ecf1065ed2db" kindref="member">min</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>||<sp/>s-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>&gt;<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a16150970f1caf28961255bacf5ec6d22" kindref="member">max</ref>.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>||<sp/>s-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&lt;<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a72574eae9f12009fd339ecf1065ed2db" kindref="member">min</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>||<sp/>s-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>&gt;<sp/>rect-&gt;<ref refid="struct__jcv__rect_1a16150970f1caf28961255bacf5ec6d22" kindref="member">max</ref>.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset++;</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"></highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/>sites[i<sp/>-<sp/>offset]<sp/>=<sp/>sites[i];</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/>num_points<sp/>-=<sp/>offset;</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"></highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1a466fea28608fbb307fe9f26fb8cd7c79" kindref="member">internal</ref><sp/>=<sp/>internal;</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/>d-&gt;<ref refid="struct__jcv__diagram_1a6684510ae98f93978135c10a41ee5914" kindref="member">numsites</ref><sp/>=<sp/>num_points;</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"></highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/>internal-&gt;numsites<sp/>=<sp/>num_points;</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/>internal-&gt;numsites_sqrt<sp/>=<sp/>(int)(<ref refid="jc__voronoi_8h_1afe69737cad28c5d558fe3cea50966e9b" kindref="member">JCV_SQRT</ref>((<ref refid="jc__voronoi_8h_1adf3f9d7c9b8b63b4537db4843afc562f" kindref="member">jcv_real</ref>)num_points));</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/>internal-&gt;currentsite<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"></highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/>internal-&gt;bottomsite<sp/>=<sp/>jcv_nextsite(internal);</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"></highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/>jcv_priorityqueue*<sp/>pq<sp/>=<sp/>internal-&gt;eventqueue;</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><ref refid="jc__voronoi_8h_1a5386281099d8669709643c318b500893" kindref="member">jcv_site</ref>*<sp/>site<sp/>=<sp/>jcv_nextsite(internal);</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"></highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>finished<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(!finished)<sp/>{</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="jc__voronoi_8h_1a7f4dcdffe3318ec1307e9b680ce05fe4" kindref="member">jcv_point</ref><sp/>lowest_pq_point;</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!jcv_pq_empty(pq))<sp/>{</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>jcv_halfedge*<sp/>he<sp/>=<sp/>(jcv_halfedge*)jcv_pq_top(pq);</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lowest_pq_point.<ref refid="struct__jcv__point_1a2bed5e1c6148d676bb38d0616810c4f9" kindref="member">x</ref><sp/>=<sp/>he-&gt;vertex.x;</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lowest_pq_point.<ref refid="struct__jcv__point_1af568d5018baddc1dd1201cd188af39f8" kindref="member">y</ref><sp/>=<sp/>he-&gt;y;</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"></highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(site<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>(jcv_pq_empty(pq)<sp/>||<sp/>jcv_point_less(&amp;site-&gt;<ref refid="struct__jcv__site_1ad84e04d2917a2263eb32cc80597e336b" kindref="member">p</ref>,<sp/>&amp;lowest_pq_point)))<sp/>{</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>jcv_site_event(internal,<sp/>site);</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>site<sp/>=<sp/>jcv_nextsite(internal);</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!jcv_pq_empty(pq))<sp/>{</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>jcv_circle_event(internal);</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>finished<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"></highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(jcv_halfedge*<sp/>he<sp/>=<sp/>internal-&gt;beachline_start-&gt;right;<sp/>he<sp/>!=<sp/>internal-&gt;beachline_end;<sp/>he<sp/>=<sp/>he-&gt;right)<sp/>{</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/>jcv_finishline(internal,<sp/>he-&gt;edge);</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"></highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/>jcv_fillgaps(d);</highlight></codeline>
<codeline lineno="1258"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"></highlight></codeline>
<codeline lineno="1260"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/><sp/></highlight><highlight class="comment">//<sp/>JC_VORONOI_IMPLEMENTATION</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/Users/xun/github/geoda-lib/src/cpp/utils/jc_voronoi.h"/>
  </compounddef>
</doxygen>
